# Nginx reverse proxy configuration

upstream <%= serivce_entry %> {
    # fail_timeout=0 means we always retry an upstream even if it failed
    # to return a good HTTP response (in case the Puma master nukes a
    # single worker for timing out).

    # for UNIX domain socket setups:
    # server unix:<%= ruby_socket_file %> fail_timeout=0;

    # for TCP setups, point these to the backend servers
    # server 192.168.0.7:<%= tcp_port %> fail_timeout=0;
    # server 192.168.0.8:<%= tcp_port %> fail_timeout=0;
    # server 192.168.0.9:<%= tcp_port %> fail_timeout=0;
}

server {
    # listen <%= tcp_port %>;
    # server_name <%= virtual_host %>;

    # ~2 seconds is often enough for most cases to parse HTML/CSS and
    # retrieve needed images/icons/frames, connections are cheap in
    # nginx so increasing this is generally safe...
    keepalive_timeout 5;

    # path for static files
    # root <%= current_path %>/public;

    location ~ ^/assets/ {
        gzip_static on; # to serve pre-gizpped version
        expires 1y;
        add_header Cache-Control public;
        add_header ETag "";
        break;
    }

    try_files $uri/index.html $uri.html $uri @app;

    location @app {
      proxy_pass http://<%= service_entry %>;
    }
}
